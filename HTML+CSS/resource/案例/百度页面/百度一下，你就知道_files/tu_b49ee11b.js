(function(){var h={};if(location.protocol==="http:"){h.uploadServer="http://graph.baidu.com/upload"}else{h.uploadServer="https://sp0.baidu.com/-aYHfD0a2gU2pMbgoY3K/upload"}var f=navigator.platform.toUpperCase();var c=$("#kw");var a=c.parent();var t=bds&&bds.comm&&bds.comm.newindex;var i=f.indexOf("MAC")!==-1;var q="result";if(t){q="newindex"}else{if(bds&&bds.comm&&bds.comm.ishome){q="index"}else{if(/^\/imgsearch/.test(location.pathname)){q="imgresult"}}}var s=function(y){y.stopPropagation();y.preventDefault()};var p=location.href.match(/sign=(\w{32})\b/);var v=p&&p[1]||"";function n(y){var z=new RegExp("(^|&)"+y+"=([^&]*)(&|$)","i");var A=window.location.search.substr(1).match(z);if(A!=null){return(A[2])}return null}var e=function(y){y.sign=v;y.fm="inlo";if(y.rsv_imageclick){y.rsv_imageclick=q+"_"+y.rsv_imageclick}window.ns_c(y)};var r=window.bds&&bds.se&&bds.se.upn&&bds.se.upn.cookieset||[];var l=r[0]&&r[0].v===1&&r[1]&&r[1].v<=3;var m=r[0]&&r[0].v===1;var d=function(y){return(/^(((http[s]?:\/\/)|(ftp:\/\/))?([\w-]+\.)+(com|edu|gov|int|mil|net|org|biz|info|pro|name|museum|coop|aero|xxx|idv|al|dz|af|ar|ae|aw|om|az|eg|et|ie|ee|ad|ao|ai|ag|at|au|mo|bb|pg|bs|pk|py|ps|bh|pa|br|by|bm|bg|mp|bj|be|is|pr|ba|pl|bo|bz|bw|bt|bf|bi|bv|kp|gq|dk|de|tl|tp|tg|dm|do|ru|ec|er|fr|fo|pf|gf|tf|va|ph|fj|fi|cv|fk|gm|cg|cd|co|cr|gg|gd|gl|ge|cu|gp|gu|gy|kz|ht|kr|nl|an|hm|hn|ki|dj|kg|gn|gw|ca|gh|ga|kh|cz|zw|cm|qa|ky|km|ci|kw|cc|hr|ke|ck|lv|ls|la|lb|lt|lr|ly|li|re|lu|rw|ro|mg|im|mv|mt|mw|my|ml|mk|mh|mq|yt|mu|mr|us|um|as|vi|mn|ms|bd|pe|fm|mm|md|ma|mc|mz|mx|nr|np|ni|ne|ng|nu|no|nf|na|za|zq|aq|gs|eu|pw|pn|pt|jp|se|ch|sv|ws|yu|sl|sn|cy|sc|sa|cx|st|sh|kn|lc|sm|pm|vc|lk|sk|si|sj|sz|sd|sr|sb|so|tj|tw|th|tz|to|tc|tt|tn|tv|tr|tm|tk|wf|vu|gt|ve|bn|ug|ua|uy|uz|es|eh|gr|hk|sg|nc|nz|hu|sy|jm|am|ac|ye|iq|ir|il|it|in|id|uk|vg|io|jo|vn|zm|je|td|gi|cl|cf|cn)(:\d+)?(\/[^\s]*)?)$/).test(y)
};var k=1024*1024*10;var g=1024*100;var w={"1":"抱歉，您上传的文件不是图片格式","2":"图片上传失败"};var o=function(B){var D=$.Deferred();function z(F,G){var E=new FileReader();E.onload=function(){var H=this.result.split("base64,")[1];G(H,this.result)};E.onerror=function(H){G()};E.readAsDataURL(F)}function C(O,F,G){F=F||"";G=G||512;var K=atob(O);var M=[];var J=K.length;for(var H=0;H<J;H+=G){var N=K.slice(H,H+G);var L=new Array(N.length);for(var I=0;I<N.length;I++){L[I]=N.charCodeAt(I)}var E=new Uint8Array(L);M.push(E)}return new Blob(M,{type:F})}function y(G){var J=G.width;var E=G.height;if(J>800||E>800){var I=Math.max(J/800,E/800);J/=I;E/=I}var H=document.createElement("canvas");H.width=J;H.height=E;var F=H.getContext("2d");F.fillRect(0,0,H.width,H.height);F.drawImage(G,0,0,J,E);var K=H.toDataURL("image/jpeg",1);return C(K.replace(/^.*?,/,""),"image/jpeg")}var A=B.size;z(B,function(E,G){var F=new Image();F.onload=function(){if(A<g&&F.width<800&&F.height<800){D.resolve(B);return}B=y(F);D.resolve(B)};F.src=G});
return D.promise()};var b=function(){var A;var y=function(C,B){if(C!==""){return C+B.slice(0,1).toUpperCase()+B.slice(1)}return B};var z=(function(){var B=false;if(typeof window.screenX==="number"){["webkit","moz","ms","o",""].forEach(function(C){if(B===false&&document[y(C,"hidden")]!==undefined){A=C;B=true}})}return B})();if(z){return document[y(A,"hidden")]}return undefined};var u=function(y){var z=$("#form").attr("target");if(z==="_blank"){window.open(y,"_blank");setTimeout(function(){if(!b()){location.href=y}},1000)}else{location.href=y}};var x=function(y){$.extend(this,{wrap:null},y);this.state="normal"};$.extend(x.prototype,{init:function(){},clean:function(){this.wrap.find(".soutu-mask").remove()},setNormal:function(){this.clean();var y=this.wrap.find(".upload-pic");y.val("");this.state="normal"},setWaiting:function(){this.clean();this.state="waiting";var z='<div class="soutu-waiting"><div class="ball"><div class="b"></div><div class="b"></div><div class="b"></div></div><span>正在加载图片</span></div>';
this.wrap.append(this.getHtml(z));var A=[[0,40],[20,20],[40,0]];var y=["rgb(55,137,250)","rgb(99,99,99)","rgb(235,67,70)"];this.wrap.find(".b").each(function(C,E){var D=0;$(E).css({"background-color":y[C]});(function B(){$(E).animate({left:A[C][D%2]},{duration:800,easing:"swing",progress:function(G,F){if(F>=0.5){$(E).css({"background-color":y[(D+C)%3]})}},complete:function(){B()}});D++})()})},setError:function(z){this.clean();this.state="error";z=z||w["2"];var y='<div class="soutu-error"><i class="soutu-icon soutu-error-icon"></i><p class="soutu-error-main">'+z+'，请<a href="#" class="soutu-error-upload">重新上传</a></p><p class="soutu-error-tip">仅支持10M以下JPG,JPEG,PNG,BMP,GIF格式图片</p></div>';this.wrap.append(this.getHtml(y))},setActiving:function(){if(this.state!=="activing"){this._setActive(1);this.state="activing"}},setActive:function(){if(this.state!=="active"){this._setActive();this.state="active"}},_setActive:function(y){this.clean();if(this.activeLayer){$(this.getHtml(this.activeLayer,"background-color:"+(y?"#ededed":"#f6f6f6")+";")).appendTo(this.wrap)
}},getHtml:function(z,y){y=y||"";return'<div class="soutu-mask" style="'+y+'">'+z+"</div>"},show:function(){},hide:function(){}});var j=function(y){this.config={};$.extend(this.config,h,y);this.state="normal";this.init();this.canDrop="ondrop" in document.body;this.canAjaxForm="FormData" in window};$.extend(j.prototype,{init:function(){var z=this;a.addClass(i?"soutu_mac":"soutu_nomac");var y=$('<link rel="stylesheet" href="https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/soutu/css/soutu_1815c820.css" type="text/css" data-for="result"/>');if(t){y.insertBefore(a.parent())}else{y.appendTo("head")}this.$Btn=$('<span class="ipt_photo"></span>').prependTo($("#kw").parent()).hover(function(){z.$Btn.addClass("ipt_photo_hover")},function(){z.$Btn.removeClass("ipt_photo_hover")}).on("click",function(A){A.stopPropagation();A.preventDefault();z.addPanel();z.$Btn.hide();z.log({rsv_imageclick:"camerabtn"})});if(i){this.$Btn.addClass("ipt_photo_mac")}if(t){this.$Btn.parent().addClass("s_ipt_wr_newIndex")}$(window).one("index_off",function(){z.$Btn.parent().removeClass("s_ipt_wr_newIndex")
});if(!l){$("#kw").on("drop.soutu",function(A){if(A.originalEvent.dataTransfer&&A.originalEvent.dataTransfer.files&&A.originalEvent.dataTransfer.files.length){s(A);z.$Btn.trigger("click");z.handleDrop(A);z.log({rsv_imageclick:"iptdrop"})}}).on("dragover.soutu",function(A){return !m});if($(".soutu-input-image").length){$(".soutu-input-image").on("click",function(){z.log({rsv_imageclick:"delimg"})})}$(document).on("dragstart.soutu",function(F){var A=F.originalEvent.dataTransfer;var E=F.target||F.srcElement;var G=E.nodeName.toLowerCase();var C;if(G==="img"){z.$Btn.trigger("click");C=E.src;try{A.setData("text/plain",C)}catch(D){A.setData("Text",C)}}else{if(G==="a"){var B=$(E).children("img");if(B.length){z.$Btn.trigger("click");C=B[0].src;try{A.setData("text/plain",C)}catch(D){A.setData("Text",C)}}}}})}},hidePanel:function(){this.$wrap.hide();this.wrapHidden=true},show:function(){if(window.pageState===1&&!this.$wrap.hasClass("result")){this.$wrap.addClass("result")}if(t&&bds.comm.ishome){this.$wrap.addClass("new");
if(!window.s_session||!!s_session.userSkinName===false){this.$wrap.addClass("no-skin")}}this.$wrap.show()},close:function(){this.$wrap.hide();this.$Btn.show();this.setState("normal");this.$urlErrorTip.hide();this.$kw.val("")},addPanel:function(){var y=this;this.wrapHidden=false;if(this.$wrap){this.show();return}this.$wrap=$('<div class="soutu-wrap"><div class="soutu-fake"><span class="soutu-fake-wrap"><input id="soutu-fake-kw" class="soutu-s-ipt" maxlength="255" autocomplete="off" placeholder="在此处粘贴图片网址"/></span><span class="soutu-fake-btn"><i class="soutu-icon soutu-fake-btn-icon"></i></span><span class="soutu-url-error">请输入正确的图片网址</span></div><div class="soutu-hr"><div class="soutu-drop" style="display:none;"><span class="soutu-drop-tip">拖拽图片到这里</span><i class="soutu-icon soutu-drop-icon"></i></div><div class="upload-wrap"><input type="file" data-nolog="1" class="upload-pic" value="上传图片"/><i class="soutu-icon upload-icon"></i><span class="upload-text">本地上传图片</span></div></div><a class="soutu-icon soutu-close" data-nolog="1" href="javascript:void(0);"></a></div>').prependTo($("#form"));
this.$kw=this.$wrap.find("#soutu-fake-kw").on("focus",function(){y.$wrap.find(".soutu-fake-wrap").addClass("focus")}).on("blur",function(){y.$wrap.find(".soutu-fake-wrap").removeClass("focus")});this.$dropArea=this.$wrap.find(".soutu-drop");this.$kw.on("keydown",function(A){var z=A.keyCode;if(y.$urlErrorTip.css("display")!=="none"){y.$urlErrorTip.hide()}if(z===13){y.submit(this.value);A.stopPropagation();A.preventDefault();return false}});this.$urlErrorTip=this.$wrap.find(".soutu-url-error");this.$wrap.find(".soutu-fake-btn").on("click",function(){var z=y.$kw.val();y.submit(z,true)});this.$wrap.find(".soutu-fake-btn").on("mouseover",function(){$(this).addClass("btnhover")}).on("mouseout",function(){$(this).removeClass("btnhover")});if(!this.canAjaxForm){this.hackFlash()}this.$wrap.find(".soutu-close").on("click",function(){y.close(true);y.log({rsv_imageclick:"close"})});$(document).click(function(z){y.document_click(z)});this.$wrap.find(".upload-pic").on("change",function(){var z=this.files[0];
y.upload(z)});this.$wrap.find(".upload-pic").on("click",function(){y.log({rsv_imageclick:"uploadbtn"})});if(this.canDrop&&!l){this.setDragAndDrop()}this.masks=[new x({wrap:this.$wrap})];this.show();$(window).one("index_off",function(){y.$wrap.removeClass("new");y.$wrap.removeClass("no-skin")})},setState:function(B){this.state=B;var y=this.masks[0];B=B.charAt(0).toUpperCase()+B.substring(1);var z=[].slice.call(arguments);[].shift.call(z);if(B==="Activing"){this.$dropArea.addClass("drag-over")}else{this.$dropArea.removeClass("drag-over")}y["set"+B].apply(y,z);if(B==="Error"){var A=this;this.$wrap.find(".soutu-error-upload").click(function(C){C.stopPropagation();C.preventDefault();A.setState("normal")})}},document_click:function(B){var A=this;var z=B.target;var y=true;do{if(z===A.$wrap[0]||z===A.$Btn[0]){y=false;break}}while(z=z.parentNode);if(y){A.close()}},doAjax:function(z){var y=this;if(this.state!=="waiting"){this.setState("waiting")}$.ajax({url:y.config.uploadServer,type:"POST",data:z,processData:false,contentType:false,success:function(A){y.uploadComplete(A)
},error:function(){y.setState("error")},always:function(){}})},uploadUrl:function(y){var z=new FormData();z.append("image",y);this.doAjax(z);this.log({rsv_imageclick:"uploadurl"})},upload:function(y){var A=this;var z=this.validate(y);if(z){this.setState("error",w[z]);return}this.setState("waiting");o(y).then(function(B){var C=new FormData();C.append("image",B);A.doAjax(C);A.log({rsv_imageclick:"uploadfile"})})},uploadComplete:function(y){var z=this;if(y&&y.command&&y.command.mode===2&&y.data){setTimeout(function(){var B=n("imgorigin")||q;var C="";var A=C+"/imgsearch?wd="+encodeURIComponent(y.data.wd)+"&sign="+encodeURIComponent(y.data.sign)+"&imgpre="+q+"&imgorigin="+B;z.close();u(A)},y.command.interval||3000)}else{this.setState("error")}},submit:function(z,y){this.setURL(z,y)},validate:function(z){var B=["jpg","jpeg","png","bmp","gif"];var y=z.name.split(".");var A=y.pop().toLowerCase();if(!z.type||!A||$.inArray(A,B)===-1){return 1}if(z.size>k){return 2}return 0},setURL:function(z,y){if(d(z)){this.$kw.val(z);
this.setState("normal");this.$urlErrorTip.hide();if(y){this.log({rsv_imageclick:"imgsearchbtn-success"})}this.uploadUrl(z)}else{this.setState("normal");this.$urlErrorTip.show();if(y){this.log({rsv_imageclick:"imgsearchbtn-error"})}}},handleDrop:function(D){var C=this;var y;if(D.originalEvent.dataTransfer){y=D.originalEvent.dataTransfer.files}if(!y||y.length===0){var z;try{z=D.originalEvent.dataTransfer.getData("text/plain")||D.originalEvent.dataTransfer.getData("text/uri-list")}catch(B){z=D.originalEvent.dataTransfer.getData("Text")||D.originalEvent.dataTransfer.getData("URL")}if(z){C.setURL(z)}else{C.setState("normal");C.$urlErrorTip.show()}return}var A=y[0];C.upload(A)},setDragAndDrop:function(){var y=this;this.$dropArea.show();y.$dropArea.on("dragover",function(z){y.setState("activing");s(z)}).on("dragleave",function(z){y.setState("normal");s(z)}).on("drop",function(z){s(z);y.handleDrop(z)});this.$kw.on("dragover.soutu dragleave.soutu",function(z){s(z)}).on("drop.soutu",function(z){s(z);
y.handleDrop(z)})},hackFlash:function(){var G=this;var y="11.1.0";var D="playerProductInstall.swf";var A={};var B={};var E="https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/static/protocol/https/soutu/js/upload_ef39d94f.swf";B.quality="high";B.bgcolor="#ffffff";B.allowscriptaccess="always";B.allowfullscreen="false";B.wmode="transparent";A.uploadServer=this.config.uploadServer;var C={};C.id="upload_flash";C.name="upload_flash";C.align="middle";var z=null;var F=$.Deferred();this.$wrap.find(".upload-pic").parent().append('<div class="flash-wrap" style="position:absolute;"><div id="upload_flashContent"></div></div>').end().remove();swfobject.embedSWF(E,"upload_flashContent","100","23",y,D,A,B,C,function(H){z=H.ref});j.swfloaded=function(){F.resolve()};j.uploading=function(){G.setState("waiting")};j.complete=function(H){G.uploadComplete(H)};F.done(function(){})},log:e});if(typeof define==="function"){define("soutu.index",[],function(){window.__soutu=j;return new j()})}})();